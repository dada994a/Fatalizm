package we.devs.forever.client.modules.impl.exploit;

import net.minecraft.client.gui.inventory.GuiChest;
import net.minecraft.client.gui.inventory.GuiContainer;
import net.minecraft.network.play.client.CPacketCloseWindow;
import org.lwjgl.input.Keyboard;
import we.devs.forever.api.event.events.network.PacketEvent;
import we.devs.forever.api.event.events.player.MotionEvent;
import we.devs.forever.api.event.eventsys.annotated.handler.annotation.EventListener;
import we.devs.forever.client.modules.api.Module;
import we.devs.forever.client.setting.Bind;
import we.devs.forever.client.setting.Setting;

public class ECExploit extends Module {
    GuiContainer lastGui;
    boolean closeInv;
    public static boolean cancelRender = false;
    public static Setting<Bind> openBind = new Setting<>("OpenBind", new Bind(Keyboard.KEY_NONE), "Bind for open EnderChest's gui");

    public ECExploit() {
        super("EnderChestBackpack", "", Category.EXPLOIT);
    }

        @EventListener
            public void onPreUpdate ( final MotionEvent.Pre event) {
                if (mc.currentScreen instanceof GuiChest) {
                    lastGui = (GuiContainer) mc.currentScreen;
                }
                if (Keyboard.isKeyDown(openBind.getValue().getKey())) {
                    if (lastGui == null) {
                        return;
                    }
                    mc.displayGuiScreen(lastGui);
                }
            }

        @EventListener
        public void onPacket ( final PacketEvent.Send eventSendPacket){
        if (eventSendPacket.getPacket() instanceof CPacketCloseWindow && lastGui != null) {
            eventSendPacket.cancel();
        }
    }

        @Override
        public void onDisable () {
        super.onDisable();
        if (lastGui != null) {
            mc.player.connection.sendPacket(new CPacketCloseWindow(lastGui.inventorySlots.windowId));
        }
        lastGui = null;
    }
}